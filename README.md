
Тестовое задание "Начисление бонусов за покупку".  
Решение выложено на github по ссылке:
https://github.com/alexregnif/test_spx  
Так же проект можно собрать при помощи Maven из консоли, последовательно используя команды (в корне проекта) для ОС Windows:  
mvn compile  
mvn exec:java -Dexec.mainClass="ru.toropin.spx.BonusLoyaltySystemApp"  

//Пояснительная записка  

Текущая реализация демонстрирует один из возможных вариантов трактовки задачи.  
В последующем необходима встреча с заказчиком для уточнения требований.  

Реализуемый вариант трактовки ТЗ, исходя из имеющихся данных:  
Сценарии проведения операций с точки зрения клиента:  
В зависимости от суммы покупки клиенту начисляются бонусы на его специальный счет бонусов в банке.
- В случае покупки до 300 рублей включительно:
  В Shop начисляется 10% от суммы покупки, в Online 17% от суммы покупки.
- В случае покупки более 300 рублей:
  И в Shop, и в Online начисляется 30%.


Сценарии проведения операций с точки зрения банка:  
В случае покупки менее 20 рублей, торговая точка (Shop, Online) оплачивает Банку комиссию в размере 10% от суммы покупки.  
В требуемых по ТЗ REST контроллерах не говорится о комиссиях или их суммах, поэтому реализация этого функционала не предусмотрена в данном варианте.  

Для этих целей создан метод с заглушкой, для дальнейшей реализации, после уточнения требований - getComissionToBank(amountOfPayment);  

Предусмотрена обработка ошибок:
- некорректный ввод параметра shopType   
- некорректный ввод параметра amount
- проверка баланса клиента перед оплатой на запрашиваемую сумму платежа  
- проверка входного параметра amount > 0

Создан Controller с 3 методами:  
@GetMapping("/payment/{shopType}/{amount}") - проведение оплаты в Shop | Online на выбранную сумму.  
@GetMapping("/money") - запрос текущего баланса на Руб счете.  
@GetMapping("/bankAccountOfEMoney") - запрос баланса бонусов.  

Создан класс Customer, с начальным балансом 5000 рублей, c полями:  
RubAccount - Счет рублей  
BonusAccount - счет бонусов  
Для реализации задачи выбран паттерн Singleton, тк по условиям ТЗ клиент всегда один.

Для учета состояний платежа использован шаблон state.  
Учитываются состояния: платеж в Shop, платеж в Online. Создан интерфейс с двумя имплементациями для Shop и Online.  
Создан контекст состояний для установки платежа и вызова соответствующего метода.  

Создан класс TransactionResult для обертки ответов в формате json.  

Создан класс RubAccountExсeption для обработки нестандартных ошибок.

Разбор операций в тестовых кейсах при данной трактовке ТЗ:
1. Online/100.    
   Cчет клиента А: - 100 = 4900    
   Бонусный счет клиента А: 100*0,17 = +17 Итог: 17


2. Shop/120    
   Cчет клиента А: -120 = 4780  
   Бонусный счет клиента А: 120*0,10 = +12 Итог: 29


3. Online/301   
   Cчет клиента А: -301 = 4479   
   Бонусный счет клиента А: 301*0,30 = +90,30 Итог: 119,30


4. Online/17    
   Cчет клиента А: -17 = 4462  
   Бонусный счет клиента А: 17*0,17 = +2,89 Итог: 122,19  
   Комиссия 1,7 руб. проходит между магазином и банком, но клиента это не касается в данной реализации.


5. Shop/1000    
   Cчет клиента А: -1000 = 3462   
   Бонусный счет клиента А: 1000*0,30 = +300 Итог: 422,19


6. Online/21    
   Cчет клиента А: -21 = 3441   
   Бонусный счет клиента А: 21*0,17 = +3,57 Итог: 425,76


7. Shop/570    
   Cчет клиента А: -570 = 2871   
   Бонусный счет клиента А: 570*0,30 = +171 Итог: 596,76


8. Online/700    
   Cчет клиента А: -700 = 2171   
   Бонусный счет клиента А: 700*0,30 = +210 Итог: 806,76


